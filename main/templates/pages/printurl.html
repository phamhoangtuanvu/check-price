{% extends "pages/base.html" %}
{% block title %}
Kết quả
{% endblock title %}
{% block main %}
    <div class="container-fluid">
        <div class="row mb-4 mt-4">
            <div class="col-lg-12">
                <div class="bg-white border">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="url-input">
                                <img src="{{data.thuoc_tinh_urlin.Url.UrlImage}}" alt="" style="min-width: 300px;max-width: 360px; ">
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="info url-input">
                                <h4 class="font-weight-bold" style="color:#1ed1a8">{{data.thuoc_tinh_urlin.SanPham.TenSP}}</h4>
                                <div class="price" ><span class="mr-2"><i class="text-success"></i>{% load humanize %}{{data.thuoc_tinh_urlin.GiaMoi1 | floatformat:"0" |intcomma }} đ</span><span class="mr-2 cut">{{data.thuoc_tinh_urlin.GiaGoc1 | floatformat:"0" |intcomma}} đ</span></div>
                                <!--
                                <div class="d-flex flex-row">
                                    <div class="icons mr-2"><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-half-o"></i><i class="fa fa-star-o"></i></div><span>1200 ratings &amp; 564 reviews</span>
                                </div>
                                -->
                                <div class="row mb-1 mt-4 " style="align-items: center;">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center offers">
                                            <span class=" font-weight-bold" data-toggle="tooltip" title="Phần trăm của giá khuyến mãi so với giá gốc">Phần trăm giảm</span>
                                        </div>
                                    </div>
                                    <script>
                                    $(document).ready(function(){
                                    $('[data-toggle="tooltip"]').tooltip();   
                                    });
                                    </script>
                                    <div class="col-md-6">
                                        <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" style="width:{{data.analytics.saleoff}}%;background-color: #1ed1a8;">{{data.analytics.saleoff}}%</div></div>
                                    </div>
                                </div>
            
                                <div class="row mb-1 mt-1 " style="align-items: center;">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center offers mb-1"><span class=" font-weight-bold" data-toggle="tooltip" title="Chênh lệch giá gốc trung bình: Biểu thị % chênh lệch giá gốc của sản phẩm so với giá gốc của các sản phẩm cùng loại ">CL Giá gốc TB</span></div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" style="width:{{data.analytics.cl_giagoctrungbinh }}%;background-color: #1ed1a8;">{{data.analytics.cl_giagoctrungbinh| floatformat:'2'}}%</div></div>
                                    </div>
                                </div>
            
                                <div class="row mb-1 mt-1 " style="align-items: center;">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center offers mb-1"><span class=" font-weight-bold" data-toggle="tooltip" title="Chênh lệch giá khuyến mãi trung bình: Biểu thị % chênh lệch giá khuyến mãi của sản phẩm so với giá khuyến mãi của các sản phẩm cùng loại">CL Giá KM TB</span></div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" style="width:{{data.analytics.cl_giamoitrungbinh}}%;background-color: #1ed1a8;">{{data.analytics.cl_giamoitrungbinh | floatformat:'2'   }}%</div></div>
                                    </div>
                                </div>
            
                                <div class="row mb-1 mt-1 " style="align-items: center;">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center offers"><span class=" font-weight-bold" data-toggle="tooltip" title="Dựa trên sự thay đổi lịch sử giá của sản phẩm">Độ trung thực</span></div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated {% if data.analytics.dotrungthuc < 80 and data.analytics.dotrungthuc > 60 %}bg-warning{% endif %}{% if data.analytics.dotrungthuc <= 60 %}bg-danger{% endif %}" style="width:{{data.analytics.dotrungthuc}}%;background-color: #1ed1a8;">{{data.analytics.dotrungthuc | floatformat:'2' }} %</div></div>
                                    </div>
                                </div>
                                
                                {% if data.analytics.cl_giamoitrungbinh > 105 and data.analytics.cl_giamoitrungbinh < 110 %}
                                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                    <strong>Cảnh báo!</strong> Giá sản phẩm khá cao so với mức trung bình
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>                                
                                {% endif %}

                                {% if data.analytics.cl_giamoitrungbinh > 110 and data.analytics.cl_giamoitrungbinh < 120  %}
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    <strong>Oops!</strong> Giá sản phẩm quá cao so với mức trung bình
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>                                
                                {% endif %}
                                
                                {% if data.analytics.cl_giamoitrungbinh > 90 and data.analytics.cl_giamoitrungbinh < 95 %}
                                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                    <strong>Cảnh báo!</strong> Giá sản phẩm khá thấp so với mức trung bình
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>                                
                                {% endif %}

                                {% if data.analytics.cl_giamoitrungbinh > 85 and data.analytics.cl_giamoitrungbinh < 90  %}
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    <strong>Oops!</strong> Giá sản phẩm quá thấp so với mức trung bình
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>                                
                                {% endif %}

                                <hr>
                                <div class="row">
                                    {% if data.thuoc_tinh_urlin.MauSac %}
                                        <div class="col-md-6">
                                            <label for="">Màu sắc</label>
                                            <div class="d-flex align-items-center mt-2"> 
                                                <div class="thuoctinh">
                                                <span>
                                                    {% if data.thuoc_tinh_urlin.MauSac == 'None' or data.thuoc_tinh_urlin.MauSac == 'NONE' %}
                                                        Không có
                                                    {% else %}
                                                        {{data.thuoc_tinh_urlin.MauSac}}
                                                    {% endif %} 
                                                </span>  
                                                </div>
                                            </div>
                                        </div>                        
                                    {% endif %}
                                    {% if data.thuoc_tinh_urlin.BoNho %}
                                    <div class="col-md-6">
                                        <label for="">Bộ nhớ</label>
                                        <div class="d-flex align-items-center mt-2"> 
                                            <div class="thuoctinh">
                                                <span>
                                                    {% if data.thuoc_tinh_urlin.BoNho == 'None' or data.thuoc_tinh_urlin.BoNho == 'NONE' %}
                                                        Không có
                                                    {% else %}
                                                        {{data.thuoc_tinh_urlin.BoNho}}
                                                    {% endif %} 
                                                </span>  
                                            </div>
                                        </div>
                                    </div> 
                                    {% endif %}
            
                                </div>
                                <hr>
                                <div>
                                <span class="font-weight-bold">Nguồn bán:</span><a class="ml-2" href="{{data.thuoc_tinh_urlin.Url.Url}}">{{data.thuoc_tinh_urlin.Url.NguonBan.TenNB}}</a></div>
                                <div class="mt-3">
                                    <a href="#"><button class="btn mr-2 mb-2" type="button" data-toggle="modal" data-target="#myModal">Chi tiết về giá</button></a>
                                    <a href="#thong_so"><button class="btn mr-2 mb-2" type="button">Thông số</button></a>
                                    <a href="#mo_ta"><button class="btn mr-2 mb-2" type="button">Mô tả</button></a>
                                    <a href="/"><button class="btn btn-primary" type="button">Quay lại trang chủ</button></a>
                                </div>                            
                            </div>
                        </div>
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <div class="col-lg-4">
                            <div class="chart">
                                <h4 class="font-weight-bold" style="text-align: center;color:#1ed1a8">Biểu đồ lịch sử giá</h4>
                                <canvas id="myChart" width="400" height="400"></canvas>
                                <script>
                                var ctx = document.getElementById('myChart').getContext('2d');
                                var myChart = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: ['{{data.thuoc_tinh_urlin.Ngay5 | date:"d/m"}}', '{{data.thuoc_tinh_urlin.Ngay4 | date:"d/m"}}', '{{data.thuoc_tinh_urlin.Ngay3 | date:"d/m"}}', '{{data.thuoc_tinh_urlin.Ngay2 | date:"d/m"}}', '{{data.thuoc_tinh_urlin.Ngay1 | date:"d/m"}}'],                                        datasets: [
                                            {
                                            label: 'Giá mới',
                                            data: [ {{data.thuoc_tinh_urlin.GiaMoi5 }} , {{data.thuoc_tinh_urlin.GiaMoi4}}, {{data.thuoc_tinh_urlin.GiaMoi3}}, {{data.thuoc_tinh_urlin.GiaMoi2}}, {{data.thuoc_tinh_urlin.GiaMoi1}}],                                            backgroundColor: [
                                                '#708ff8',
                                            ],
                                            borderColor: [
                                                '#708ff8',
                                            ],
                                            borderWidth: 2,
                                            order: 1
                                            },
                                            {
                                            label: 'Giá gốc',
                                            data: [ {{data.thuoc_tinh_urlin.GiaGoc5}} , {{data.thuoc_tinh_urlin.GiaGoc4}}, {{data.thuoc_tinh_urlin.GiaGoc3}}, {{data.thuoc_tinh_urlin.GiaGoc2}}, {{data.thuoc_tinh_urlin.GiaGoc1}}],
                                            backgroundColor: [
                                                '#1ed1a8',
                                            ],
                                            borderColor: [
                                                '#1ed1a8',
                                            ],
                                            borderWidth: 2,
                                            order: 2
                                            },
                                            {
                                            label: 'Giá mới TB',
                                            data: [ {{data.giamoitrungbinh.giamoi5| floatformat:"0"}} , {{data.giamoitrungbinh.giamoi4| floatformat:"0"}}, {{data.giamoitrungbinh.giamoi3| floatformat:"0"}}, {{data.giamoitrungbinh.giamoi2| floatformat:"0"}}, {{data.giamoitrungbinh.giamoi1| floatformat:"0"}}],
                                            backgroundColor: [
                                                '#ffc107',
                                            ],
                                            borderColor: [
                                                '#ffc107',
                                            ],
                                            borderWidth: 2,
                                            order: 3
                                            }
                                        ]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: false
                                            }
                                        }
                                    }
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div class="row">
                    {% for item in data.thuoc_tinh_urlout %}
                    <div class="col-lg-3">
                        <div class="card-position card d-inline-flex border" style="align-items: center;height: 350px;";>
                                <img class="card-img-top" src="{{item.Url.NguonBan.Logo.url}}" alt="Card image" style="width:100%">
                                <div class="card-body card-body-position" style="text-align: center;">
                                    <h5 class="card-title" style="color: #708ff8;font-weight:600">{{item.Url.NguonBan.TenNB}}</h5>
                                    <h6 class="card-text">Giá mới: <strong>{{item.GiaMoi1| floatformat:"0" | intcomma}} đ</strong> </h6>
                                    <h6 class="card-text">Giá gốc: <span class="cut">{{item.GiaGoc1| floatformat:"0" | intcomma}} đ</span> </h6>
                                    <a href="{{item.Url.Url}}" ><button class="btn btn-primary">Đến nơi bán</button></a>
                                </div>
                            
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="row mt-4">
                    <div class="col-lg-12">
                        <div class="bg-white border" style="padding: 30px;">
                            <h2 style="border-bottom: #708ff8 solid 2px;padding-bottom: 10px;margin-bottom: 30px;" id="mo_ta">Mô tả</h2>
                            {{data.thuoc_tinh_urlin.Url.MoTa|safe}}   
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-lg-12">
                        <div class="bg-white border" style="padding: 30px;">
                            <h2 style="border-bottom: #708ff8 solid 2px;padding-bottom: 10px;margin-bottom: 30px;" id="thong_so">Thông số kỹ thuật</h2>
                            {{data.thuoc_tinh_urlin.Url.Tskt|safe}} 
                        </div>
                    </div>
        
                </div>
            </div>

            <div class="col-lg-4">
                <div class="sticky-top">
                    <div class="flex-column">
                        <div class="bg-white border">
                            <div class="text-center">
                                <h4 style="margin-top: 20px;">Sản phẩm tương tự</h4>
                                <hr>
                                {% for item in data.list_url_chung_nb %}
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <img class="card-img-top" src="{{item.SanPham.ImgSP}}" alt="Card image" style="width:80%">
                                        </div>
                                        <div class="col-lg-8">
                                            <div class="card-body card-body-position" style="text-align: center;">
                                                <h6 class="card-title" style="color: #708ff8;font-weight:600">{{item.SanPham.TenSP}}</h6>
                                                <a href="{% url 'url_handling' item.SanPham.TenSP %}" ><button class="btn btn-primary">Xem sản phẩm</button></a>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>                                
                                {% endfor %}
                            </div>
                        </div>
                    
                    </div>
                </div>
            </div>
            

        </div>
        
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner border">
                      <div class="carousel-item active">
                        <img class="d-block w-100" src="https://a.ipricegroup.com/october-cms/000_CAMPAIGN_000/2021/VN/Grab%20June%20Campaign/GrabFood/Banner%201200x200-min.png" alt="First slide">
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="https://a.ipricegroup.com/october-cms/Campaigns/2021/Flowerstore%20VN/Fathers%20Day%20Campaign/desktop.jpeg" alt="Second slide">
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="https://a.ipricegroup.com/october-cms/Campaigns/2021/MrSpeedy%20VN/MrSpeedy_Banner%20iPrice%201200%20x%20200.png" alt="Third slide">
                      </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
            </div>
        </div>
    </div>

        <!-- The Modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">
            
                <!-- Modal Header -->
                <div class="modal-header">
                <h4 class="modal-title">Chi tiết về giá</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                
                <!-- Modal body -->
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>Nguồn bán</th>
                            <th>Giá gốc</th>
                            <th>Giá mới</th>
                            <th>Url</th>
                          </tr>
                        </thead>
                        <tbody>
                        {% for item in data.thuoc_tinh_urlout %}
                          <tr>
                            <td>{{item.NguonBan.TenNB}}</td>
                            <td>{{item.GiaGoc1| floatformat:"0" | intcomma}} đ</td>
                            <td>{{item.GiaMoi1| floatformat:"0" | intcomma}} đ</td>
                            <td><a href="{{item.Url.Url}}" target="blank"><button class="btn btn-primary">Đến nơi bán</button></a></td>
                          </tr>                        
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Modal footer -->
                <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
                </div>
                
            </div>
        </div>
    </div>
{% endblock main %}

